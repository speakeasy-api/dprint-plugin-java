# dprint-plugin-java vs Spotless:PJF Formatting Comparison

## Test Configuration
- **Test SDK**: sdk-javav2 from PR #3837 (openapi-generation)
- **Total Java Files**: 473
- **dprint Version**: Built from current master
- **PJF Version**: palantir-java-format via Spotless 7.0.2
- **Comparison Date**: 2026-02-15

## Performance
- **dprint**: 0.215s for 464 files (formatted)
- **Spotless/PJF**: ~10s for same files via Gradle
- **Speedup**: ~46x faster

## Match Results

### Raw Comparison (no normalization)
- **Identical**: 9/473 files (1.9%)
- **Different**: 464/473 files (98.1%)

### Normalized Comparison (imports sorted, java.lang.* removed, trailing ws stripped)
- **Identical**: 201/473 files (42.5%)
- **Different**: 272/473 files (57.5%)

## Major Formatting Differences

### 1. **Blank Lines Between Class Members** (DPRINT ADDS EXTRA)
**Impact**: 272+ files affected
**What**: dprint adds blank line after class opening brace and between field declarations
**Example**:
```java
// DPRINT
public class SDK {

    private static final Headers _headers = Headers.EMPTY;

    private final AsyncSDK asyncSDK;

// PJF
public class SDK {
    private static final Headers _headers = Headers.EMPTY;
    private final AsyncSDK asyncSDK;
```

### 2. **Annotation Placement** (109 files)
**What**: PJF keeps annotations on same line when method call chains span lines; dprint wraps differently
**Example**:
```java
// DPRINT
@Test
void shouldUseCustomBeansWhenProvided() {
    contextRunner.withUserConfiguration(CustomBeansConfiguration.class)
            .withPropertyValues("openapi.security.option3.oauth2=test-token")

// PJF
@Test
void shouldUseCustomBeansWhenProvided() {
    contextRunner
            .withUserConfiguration(CustomBeansConfiguration.class)
            .withPropertyValues("openapi.security.option3.oauth2=test-token")
```

### 3. **Argument List Wrapping** (92 files)
**What**: PJF keeps short multi-arg calls on one line; dprint wraps more aggressively
**Example**:
```java
// DPRINT
public static final String USER_AGENT = String.format(
        "speakeasy-sdk/%s %s %s %s %s",
        LANGUAGE,
        SDK_VERSION,
        GEN_VERSION,
        OPENAPI_DOC_VERSION,
        BASE_PACKAGE);

// PJF (all on one line)
public static final String USER_AGENT = String.format(
        "speakeasy-sdk/%s %s %s %s %s", LANGUAGE, SDK_VERSION, GEN_VERSION, OPENAPI_DOC_VERSION, BASE_PACKAGE);
```

### 4. **Method Chain Wrapping** (50 files)
**What**: PJF wraps first method call on new line for builder patterns
**Example**:
```java
// DPRINT
contextRunner.withUserConfiguration(CustomBeansConfiguration.class)
        .withPropertyValues(...)

// PJF
contextRunner
        .withUserConfiguration(CustomBeansConfiguration.class)
        .withPropertyValues(...)
```

### 5. **Generic Type Parameter Wrapping** (observed)
**What**: PJF wraps long generic type parameters differently
**Example**:
```java
// DPRINT
RequestOperation<OperationWithLeadingAndTrailingUnderscoresRequest, OperationWithLeadingAndTrailingUnderscoresResponse> operation =
        new OperationWithLeadingAndTrailingUnderscores.Sync(sdkConfiguration, _headers);

// PJF
RequestOperation<
                OperationWithLeadingAndTrailingUnderscoresRequest,
                OperationWithLeadingAndTrailingUnderscoresResponse>
        operation = new OperationWithLeadingAndTrailingUnderscores.Sync(sdkConfiguration, _headers);
```

### 6. **Blank Lines After Copyright Header** (minor)
**What**: PJF adds blank line after */ closing comment, before package
**Example**:
```java
// DPRINT
/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */
package org.openapis.review.openapi;

// PJF
/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

package org.openapis.review.openapi;
```

### 7. **Comment Placement** (9 files)
**What**: Minor differences in blank lines around comments

## Summary

### What dprint Does Well
✅ Fast formatting (46x faster)
✅ Consistent indentation
✅ Proper brace placement
✅ Import handling (when normalized)

### Key Parity Gaps
❌ **Blank lines between members**: dprint adds extra blank lines that PJF omits
❌ **Argument wrapping heuristics**: PJF is smarter about keeping short arg lists on one line
❌ **Chain wrapping**: PJF wraps first call differently for builder patterns
❌ **Generic parameter wrapping**: PJF has different long-type-parameter wrapping strategy

### Recommendation Priority
1. **HIGH**: Fix blank line insertion (affects all 272 files)
2. **HIGH**: Improve argument wrapping heuristics (don't wrap if total line <120 chars)
3. **MEDIUM**: Adjust chain wrapping for builder pattern (first call on new line)
4. **LOW**: Generic type parameter wrapping strategy
5. **LOW**: Copyright header blank line

## Files for Detailed Analysis
Sample files with all issue types:
- `src/main/java/org/openapis/review/openapi/SDK.java` (blank lines, chains, args)
- `src/main/java/org/openapis/review/openapi/SDKConfiguration.java` (args, blank lines)
- `spring/openapi-spring-boot-autoconfigure/src/test/java/org/openapis/review/openapi/OpenapiAutoConfigTest.java` (annotations, chains)

# dprint-plugin-java vs Spotless:PJF Formatting Comparison

**Test Repository:** `speakeasy-api/openapi-generation` PR #3837 - `zSDKs/sdk-javav2`  
**Files Analyzed:** 473 Java files  
**Date:** 2026-02-15

## Executive Summary

After normalizing for import ordering and `java.lang.*` imports:
- **Identical:** 7 / 473 files (1%)
- **Different:** 466 / 473 files (98%)

## Formatting Gap Categories

Ranked by number of affected files:

| Category | Files | % | Description |
|----------|-------|---|-------------|
| **Blank Lines** | 451 | 95% | Missing blank lines between members, after class opening brace |
| **Argument List Wrapping** | 115 | 24% | PJF wraps more aggressively in argument lists |
| **Method Chain Wrapping** | 50 | 11% | Builder pattern chain wrapping differences |
| **Comment Placement** | 23 | 5% | Trailing comment handling, blank lines after comments |
| **Modifier Order** | 5 | 1% | `final static` vs `static final` ordering |
| **Brace Spacing** | 2 | <1% | Space in `@Target({ ... })` |
| **Annotation Placement** | 1 | <1% | Annotation on own line before method |

## Detailed Analysis

### 1. Blank Lines (451 files, 95%)

**Gap:** dprint does not add blank lines in several PJF locations:
- After package/comment header (before `package` statement)
- Between class/interface members (fields, methods, nested classes)
- After class opening brace
- Excess blank line after imports block

**Example:**
```diff
 /*
  * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
  */
+
 package org.openapis.review.openapi;
 
-
 /**
  * SDK Review: A test document...
  */
 public class SDK {
-
     private static final Headers _headers = Headers.EMPTY;
 
     /**
```

**Impact:** High - affects nearly all files

---

### 2. Argument List Wrapping (115 files, 24%)

**Gap:** PJF wraps argument lists more aggressively when arguments contain nested method calls or builders.

**Example:**
```diff
 // dprint (current)
-GetNamespaceTypesResponse res = sdk.namespaceTests().types().getNamespaceTypes().call();
+
+// PJF (target)
+GetNamespaceTypesResponse res =
+        sdk.namespaceTests().types().getNamespaceTypes().call();

-animal(Cat.builder().animalType(CatAnimalType.CAT).furLength("short").build())
+animal(Cat.builder()
+        .animalType(CatAnimalType.CAT)
+        .furLength("short")
+        .build())
```

**Impact:** Medium - affects builder pattern usage in tests

---

### 3. Method Chain Wrapping (50 files, 11%)

**Gap:** PJF wraps builder chains differently, keeping `SDK.builder()` on same line but wrapping subsequent calls.

**Example:**
```diff
 // Both formats (already matching from Phase 3 work)
 SDK sdk = SDK.builder()
         .serverURL(Utils.environmentVariable("TEST_SERVER_URL", "http://localhost:18080"))
         .client(testHttpClient)
         .build();
```

**Impact:** Low - Phase 3 work already improved this

---

### 4. Comment Placement (23 files, 5%)

**Gap:** Blank lines after trailing comments differ.

**Example:**
```diff
             hooks.registerAfterError(h);
             // TODO: async client credentials hooks are yet to be supported
-
         }
```

**Impact:** Low - mostly TODO comments

---

### 5. Modifier Order (5 files, 1%)

**Gap:** dprint preserves source order; PJF enforces JLS canonical order (`static final` vs `final static`).

**Example:**
```diff
-private static final Map<Class<?>, ...> STRING_CONVERSIONS = ...
+private static final Map<Class<?>, ...> STRING_CONVERSIONS = ...
```

**Impact:** Very Low - only 5 files affected

---

### 6. Brace Spacing (2 files, <1%)

**Gap:** `@Target({ElementType.FIELD})` formatting - dprint may add space.

**Impact:** Very Low

---

### 7. Annotation Placement (1 file, <1%)

**Gap:** `@Test` annotation placement before method.

**Impact:** Very Low

---

## Recommendations

### Priority 1: Blank Lines (P0)
- Add blank line after package/header comment
- Add blank lines between class members (fields, methods, constructors)
- Remove excess blank line after import block

**Expected Improvement:** ~95% of gap

### Priority 2: Argument List Wrapping (P1)
- Implement nested builder detection in argument lists
- Wrap when argument contains `.builder()...build()` pattern
- Apply continuation indent to wrapped arguments

**Expected Improvement:** ~24% of gap

### Priority 3: Comment Placement (P2)
- Review blank line handling after trailing comments
- Ensure consistency with PJF behavior

**Expected Improvement:** ~5% of gap

### Priority 4: Modifier Order (P3)
- Optional: enforce JLS canonical modifier order
- Trade-off: reduces flexibility, improves consistency

**Expected Improvement:** ~1% of gap

---

## Test Files Showing All Gaps

These files exhibit most formatting gap categories:

1. `src/test/java/org/openapis/review/openapi/TypesTests.java`
   - Blank lines, arglist wrapping, chain wrapping

2. `src/main/java/org/openapis/review/openapi/SDK.java`
   - Blank lines between members, comment placement

3. `src/main/java/org/openapis/review/openapi/utils/Utils.java`
   - Modifier order, comment placement

4. `src/test/java/org/openapis/review/openapi/SDKTests.java`
   - Blank lines, brace spacing, arglist wrapping

---

## Normalization Applied

Before comparison, both outputs were normalized:
- ✅ Import statements sorted alphabetically
- ✅ `java.lang.*` imports removed
- ✅ Trailing whitespace stripped

This isolates true formatting differences from import management.

---

## Conclusion

**Match Rate:** 1% (7/473 files)  
**Primary Gap:** Blank line placement (95% of files)  
**Secondary Gap:** Argument list wrapping (24% of files)

Addressing the top 2 priorities (blank lines + arglist wrapping) would bring match rate to ~70-80%.

